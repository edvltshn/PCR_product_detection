# PCR product detection
## Проект: Разработка сервиса для определения наличия ПЦР продукта по электрофореграмме.
### Домен
Электрофореграмма - это изображение колонки или пластинки после разделения и проявления сложной смеси с 
помощью электрофореза.

Электрофорез - метод анализа, основанный на способности заряженных частиц, растворенных или диспергированных 
в электролите, перемещаться под действием внешнего электрического поля. Различие физико-химических свойств 
заряженных частиц (размер, форма, величина заряда), а также влияние факторов электролитической среды 
(напряженность электрического поля, природа среды, вязкость электролита, рН, температура среды, а также 
продолжительность электрофореза) обусловливают различие скоростей перемещения частиц и, следовательно, 
обеспечивают их разделение.

В нашем проекте мы использовали изображения электрофореграммы на пластинках, которые были получены методом 
электрофореза ДНК в агарозном геле, предназначенным для определения размеров фрагментов ДНК, а также для их 
разделения по размеру.
  
Метод электрофореза ДНК в агарозном геле представляет собой разновидность зонального электрофореза.
Зональный электрофорез.
В этом методе используется неподвижный носитель, по поверхности или через объем которого осуществляется миграция 
ионов, причем стабилизация электролита на плотной матрице позволяет предотвратить конвекцию и смешивание зон после 
разделения компонентов.
Задача проекта: Автоматизация определения результатов ПЦР тестов, увеличение производительности.

### Проблема
Проблема которую решаем: На сегодняшний день определение результатов ПЦР тестов происходит "в ручную" с затратой 
времени специалиста. Нашим решением мы хотим автоматизировать этот процесс, освободить специалиста от рутинной работы
и увеличить производительность.

### Датасет: изображений электрофореграмм.

Работа с датасетом: 
В процессе работы мы использовали датасет из собственного источника и из открытого источника: 
https://dbarchive.biosciencedbc.jp/en/rgp-caps/data-2.html.

Предварительная обработка данных: Используя графические редакторы, мы разрезали каждое изображение электрофореграммы 
на отдельные изображения пластин формата .jpg и разметили данные на 3 вида таким образом: 
               yes_<номер образца>  - есть продукт
               no_<номер образца> - нет продукта
               r - линейка

               Если дублируются, то 
               yes_<номер образца>(номер) 
               yes_10(1) 
               r(1)
Пример датасета:https://drive.google.com/drive/folders/1zRnNN-gQF8hsf047AZYcJE8l8bksvfwX?usp=sharing
Так как у нас получилось 3 вида данных ( есть продукт, нет продукта, линейка) в качестве задачи машинного обучения мы
использовали классификацию с метриками accuracy и F1-мера.

### Метрики

Метрика точности (accuracy) позволяет оценить общую производительность модели, показывая, как часто модель 
правильно классифицирует объекты. Она вычисляется как отношение числа правильно классифицированных объектов к общему 
числу объектов. Точность важна, когда все классы равнозначны и нет особого интереса к определенному классу.

F1-мера является гармоническим средним между полнотой (recall) и точностью (precision). Полнота показывает, какую 
долю объектов положительного класса модель правильно классифицирует, а точность показывает, какую долю объектов, 
которые модель классифицирует как положительные, действительно являются положительными. F1-мера учитывает обе эти 
метрики и позволяет оценить модель с учетом как полноты, так и точности.

Использование и accuracy, и F1-меры позволяет получить более полное представление о производительности модели. 
Accuracy дает общую оценку, а F1-мера учитывает баланс между полнотой и точностью. Вместе эти метрики помогают 
понять, насколько хорошо модель справляется с задачей классификации.

### Бейзлайн

В качестве бейзлайна выбрана модель EfficientNetB7 и дообучена на нашем датасете в течение 10 эпох. Получившиеся метрики:
- Accuracy: 0.99
- F1-score: 0.99

Можно отметить что метрики получились очень высокие, т.к. задача классификации в нашем случае довольно простая, данные в датасете чистые и сбалансированные, модель, при этом, являлась в свое время SOTA для значительно более сложной задачи классификации. Таким образом, в качестве бейзлайна данный подход себя полностью оправдывает, но для работы в продакшене думаю, можно подобрать более легкую модель и дообучить ее до сравнимых метрик.

### Сервис

Для демонстрации работы нашего подхода создан простой сервис с использованием FastAPI и Streamlit.
Сервис запускается локально. Для запуска сервиса необходимо выполнить следующие команды:

#### Клонирование репозитория

```bash
git clone https://github.com/edvltshn/PCR_product_detection.git
cd PCR_product_detection/app
```

#### Модель

Дообученную модель можно скачать по ссылке (~250МБ): https://drive.google.com/file/d/1_r6M0baQSgtHj43oAO7DznOeOAnPvHtc/view?usp=sharing 
Файл модели необходимо положить в папку app/models

#### Бэкенд и фронтенд

```bash
# запуск FastAPI сервера:
uvicorn main:app 

# запуск фронтенд сервера на Streamlit:
streamlit run app.py
```

После выполнения команд, сервисы будут доступны на следующих портах:  
FastAPI сервер будет доступен на http://localhost:8000  
Streamlit фронтенд будет доступен на http://localhost:8500 

